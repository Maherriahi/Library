@page

@model IndexModel


@{
    ViewData["Title"] = "Profile";
    ViewData["ActivePage"] = ManageNavPages.Index;
}

        <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex flex-column align-items-center text-center "style="height:22em">
                    <div class=" w-50  rounded-circle border border-info" style="overflow:hidden;height:60%;background-size:contain">
                        @{
                            string imageSrc = "/image/upload.png"; // Default image source

                            if (Model.Input != null && Model.Input.image != null && !string.IsNullOrEmpty(Model.Input.image.imageSrc))
                            {
                                imageSrc = Model.Input.image.imageSrc; // Set image source if it's not null or empty
                            }
                        }
                        @if (!string.IsNullOrEmpty(imageSrc))
                        {
                            <img id="selectedImage" src="@imageSrc" alt="Admin" width="100%" height="100%">
                        }
                        else
                        {
                            <p>No image available</p>
                        }
                    </div>
                      <div class="mt-3  w-100 h-50">
                                <h4>@Model.student.LastName @Model.student.FirstName</h4>
                                <p class="text-secondary mb-1">@Model.student.Profession</p>
                                <p class="text-muted font-size-sm" id="addressProf">@Model.student.City, @Model.student.Country, @Model.student.PostalCode</p>
                         <form class="form-card" method="post" enctype="multipart/form-data">
                            <div class="btn btn-outline-info" id="addUpd">
                            <label class="form-label  m-1 d-flex flex-column justify-content-center align-items-center" for="customFile1" style="width:5.5em;height:1em;" id="labelfile">Choose file</label>
                            <input type="file" asp-for="Input.image.clientFile"  class="form-control d-none" id="customFile1" onchange="displaySelectedImage(event, 'selectedImage')" />
                            <span asp-validation-for="Input.image.clientFile" class="text-danger"></span>
                                 </div>
                            <button type="submit" onclick="handleSaveButtonClick()" id="saveId" class="btn btn-outline-primary">Save</button>
                        </form>
                    </div>
                        </div>
                    </div>
                </div>
                <div class="card mt-3">
                    <ul class="list-group list-group-flush p-2">
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                    <h6 class="pl-1 "><i class="fa-solid fa-globe mr-2 fs-4"></i> Website</h6>
                    <span class="text-secondary">bootdey</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                    <h6 class="pl-1 "><i class="fa-brands fa-facebook-f mr-2 text-info fs-4"></i> Facebook</h6>
                    <span class="text-secondary">bootdey</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                    <h6 class="pl-1 "><i class="fa-brands fa-github mr-2 text-dark fs-4"></i> Github</h6>
                    <span class="text-secondary">bootdey</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                    <h6 class="pl-1 "><i class="fa-brands fa-linkedin text-info mr-2 fs-4"></i> Linkedin</h6>
                    <span class="text-secondary">bootdey</span>
                </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Full Name</h6>
                            </div>
                    <div class="col-sm-9 text-secondary " id="divContent-name">
                        @Model.student.LastName @Model.student.FirstName
                    </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Email</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @Model.Username
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Phone</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                           (+216) @Model.Input.PhoneNumber
                    </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Mobile</h6>
                            </div>
                    <div class="col-sm-9 text-secondary" id="divContent-mobile">
                        @Model.student.Telephone
                    </div>
                                
                            
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Address</h6>
                            </div>
                            <div class="col-sm-9 text-secondary" id="address">
                        @Model.student.City, @Model.student.Country, @Model.student.PostalCode
                            </div>
                        </div>
                        <hr>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="d-flex" id="update">
                            <a id="deleteButton" style="width: 40%;" class="btn btn-danger" asp-area="" asp-action="Delete" asp-controller="Students" asp-route-Id="@Model.student.Id">Delete your Profile</a>
                            <a id="updateButton" style="width: 40%;" class="btn btn-info" asp-area="" asp-action="Edit" asp-controller="Students" asp-route-Id="@Model.student.Id">Update your Profile</a>
                            <a id="createButton" class="btn btn-info" asp-area="" asp-action="New" asp-controller="Students">Complete your profile</a>
                        </div>
                    </div>
                </div>
                    </div>
                </div>

                <div class="row gutters-sm">
                    <div class="col-sm-6 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="d-flex align-items-center mb-3"><i class="material-icons text-info mr-2">assignment</i>Project Status</h6>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small>Rented books</small>
                                    <small>20</small>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small>The books I currently have</small>
                                    <small>20</small>
                                  </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="d-flex align-items-center mb-3"><i class="material-icons text-info mr-2">assignment</i>Project Status</h6>
                        <div class="d-flex justify-content-between align-items-center">
                            <small>Books have been read</small>
                            <small>20</small>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <small>Book reservation</small>
                            <small>20</small>
                        </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
@section Scripts{
    <script>
        var lastName = '@Model.student.LastName';
         var telephone = '@Model.student.Telephone';

         var labelfile = document.getElementById("labelfile");
         var selectImage = document.getElementById("selectedImage");

        var btnSave = document.getElementById("saveId");
        var btnAddUpd = document.getElementById("addUpd");


        var deleteButton = document.getElementById("deleteButton");
        var updateButton = document.getElementById("updateButton");
        var createButton = document.getElementById("createButton");
        var updateContainer = document.getElementById("update");

        @if (imageSrc != "/image/upload.png") {
           @: labelfile.innerHTML = "Update";
        } else {
           @:  labelfile.innerHTML = "Upload";
        }



        if (lastName !== "" && telephone !== "") {
            // Student has data, show delete and update buttons
            deleteButton.style.display = 'inline-block';
            updateButton.style.display = 'inline-block';
            createButton.style.display = 'none';
            updateContainer.classList.add('justify-content-around');
        } else {
            // Student does not have data, show create button
            deleteButton.style.display = 'none';
            updateButton.style.display = 'none';
            createButton.style.display = 'inline-block';
            updateContainer.classList.add('justify-content-start');
            btnSave.style.display = 'none';
            btnAddUpd.style.display = 'none';
            address.innerHTML = "";
            addressProf.innerHTML = "Before uploading a photo or performing any tasks, please complete your profile. Your profile ensures we can personalize our services for you";
        }

        function displaySelectedImage(event, elementId) {
            const selectedImage = document.getElementById(elementId);
            const fileInput = event.target;

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    selectedImage.src = e.target.result;
                };

                reader.readAsDataURL(fileInput.files[0]);
            }
        }


        // Function to handle save button click
            function handleSaveButtonClick() {
            var imageSrc = "@imageSrc";
            var selectedImage = document.getElementById("selectedImage");
            var fileInput = document.getElementById("customFile1");

            if (selectedImage.src === "" || imageSrc === "/image/upload.png" || fileInput.files.length === 0) {
                // Handle case when no image is selected
                alert("Please select an image before saving.");
            } else {
                // Proceed with saving logic
                alert("Image selected, saving...");
            }
        }

    </script>
}
